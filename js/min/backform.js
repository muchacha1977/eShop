(function(){Backform={formClassName:"backform form-horizontal",groupClassName:"form-group",controlLabelClassName:"control-label col-sm-4",controlsClassName:"col-sm-8",controlClassName:"form-control",helpClassName:"help-block",errorClassName:"has-error",helpMessageClassName:"help-block",bootstrap2:function(){_.extend(Backform,{groupClassName:"control-group",controlLabelClassName:"control-label",controlsClassName:"controls",controlClassName:"input-xlarge",helpClassName:"text-error",errorClassName:"error",
helpMessageClassName:"help-message small"});_.each(Backform,function(a,b){_.isFunction(Backform[b])&&_.isFunction(Backform[b].prototype.bootstrap2)&&Backform[b].prototype.bootstrap2()})},resolveNameToClass:function(a,b){if(_.isString(a)){var c=_.map(a.split("-"),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")+b,d=Backform[c];if(_.isUndefined(d))throw new ReferenceError("Class '"+c+"' not found");return d}return a}};Backform.Form=Backbone.View.extend({fields:void 0,errorModel:void 0,
tagName:"form",className:function(){return Backform.formClassName},initialize:function(a){a.fields instanceof Backbone.Collection||(a.fields=new h(a.fields||this.fields));this.fields=a.fields;this.model.errorModel=a.errorModel||this.model.errorModel||new Backbone.Model},render:function(){this.$el.empty();var a=this.$el,b=this.model;this.fields.each(function(c){c=new (c.get("control"))({field:c,model:b});a.append(c.render().$el)});return this}});var g=Backform.Field=Backbone.Model.extend({defaults:{name:"",
placeholder:"",disabled:!1,required:!1,value:void 0,control:void 0},initialize:function(){var a=Backform.resolveNameToClass(this.get("control"),"Control");this.set({control:a},{silent:!0})}}),h=Backform.Fields=Backbone.Collection.extend({model:g}),e=Backform.Control=Backbone.View.extend({defaults:{},className:function(){return Backform.groupClassName},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x3c%-label%\x3e\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cspan class\x3d"\x3c%\x3dBackform.controlClassName%\x3e uneditable-input"\x3e\x3c%\x3dvalue%\x3e\x3c/span\x3e\n\x3c/div\x3e'),
initialize:function(a){this.field=a.field;a=this.field.get("name").split(".").shift();this.listenTo(this.model,"change:"+a,this.render);this.model.errorModel instanceof Backbone.Model&&this.listenTo(this.model.errorModel,"change:"+a,this.updateInvalid)},getValueFromDOM:function(){return this.$el.find(".uneditable-input").text()},onChange:function(a){var b=this.model;$(a.target);var c=this.field.get("name").split(".");a=c.shift();var c=c.join("."),d=this.getValueFromDOM(),e={};if(this.model.errorModel instanceof
Backbone.Model)if(_.isEmpty(c))this.model.errorModel.unset(a);else{var f=this.model.errorModel.get(a);f&&(this.keyPathSetter(f,c,null),this.model.errorModel.set(a,f))}e[a]=_.isEmpty(c)?d:_.clone(b.get(a))||{};_.isEmpty(c)||this.keyPathSetter(e[a],c,d);this.stopListening(this.model,"change:"+a,this.render);b.set(e);this.listenTo(this.model,"change:"+a,this.render)},render:function(){var a=_.defaults(this.field.toJSON(),this.defaults),b=this.model.toJSON(),c=a.name.split("."),d=c.shift(),c=c.join("."),
d=this.keyPathAccessor(b[d],c),b=_.extend(a,{value:d,attributes:b});this.$el.html(this.template(b)).addClass(a.name);this.updateInvalid();return this},clearInvalid:function(){this.$el.removeClass(Backform.errorClassName).find("."+Backform.helpClassName+".error").remove();return this},updateInvalid:function(){var a=this.model.errorModel;if(!(a instanceof Backbone.Model))return this;this.clearInvalid();var b=this.field.get("name").split("."),c=b.shift(),b=b.join("."),a=a.get(c);if(!_.isEmpty(a)&&(_.isObject(a)&&
(a=this.keyPathAccessor(a,b)),!_.isEmpty(a)))return this.$el.addClass(Backform.errorClassName),this.$el.find("."+Backform.controlsClassName).append('\x3cspan class\x3d"'+Backform.helpClassName+' error"\x3e'+(_.isArray(a)?a.join(", "):a)+"\x3c/span\x3e"),this},keyPathAccessor:function(a,b){var c=a;b=b.split(".");for(var d=0;d<b.length;d++)_.isEmpty(b[d])||_.isUndefined(c[b[d]])||(c=c[b[d]]);return _.isObject(c)&&!_.isArray(c)?null:c},keyPathSetter:function(a,b,c){for(b=b.split(".");1<b.length;)a=a[b.shift()];
return a[b.shift()]=c}});Backform.UneditableInputControl=e;Backform.HelpControl=e.extend({template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x26nbsp;\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cspan class\x3d"\x3c%\x3dBackform.helpMessageClassName%\x3e help-block"\x3e\x3c%\x3dlabel%\x3e\x3c/span\x3e\n\x3c/div\x3e')});Backform.SpacerControl=e.extend({template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x26nbsp;\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\x3c/div\x3e')});
Backform.TextareaControl=e.extend({defaults:{label:"",maxlength:4E3,extraClasses:[],helpMessage:""},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x3c%-label%\x3e\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3ctextarea class\x3d"\x3c%\x3dBackform.controlClassName%\x3e \x3c%\x3dextraClasses.join(\' \')%\x3e" name\x3d"\x3c%\x3dname%\x3e" maxlength\x3d"\x3c%\x3dmaxlength%\x3e" placeholder\x3d"\x3c%-placeholder%\x3e" \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3c%\x3drequired ? "required" : ""%\x3e\x3e\x3c%-value%\x3e\x3c/textarea\x3e\n  \x3c% if (helpMessage.length) { %\x3e\n    \x3cspan class\x3d"\x3c%\x3dBackform.helpMessageClassName%\x3e"\x3e\x3c%\x3dhelpMessage%\x3e\x3c/span\x3e\n  \x3c% } %\x3e\n\x3c/div\x3e'),
events:{"change textarea":"onChange","focus textarea":"clearInvalid"},getValueFromDOM:function(){return this.$el.find("textarea").val()}});Backform.SelectControl=e.extend({defaults:{label:"",options:[],extraClasses:[]},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x3c%-label%\x3e\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cselect class\x3d"\x3c%\x3dBackform.controlClassName%\x3e \x3c%\x3dextraClasses.join(\' \')%\x3e" name\x3d"\x3c%\x3dname%\x3e" value\x3d"\x3c%-JSON.stringify(value)%\x3e" \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3c%\x3drequired ? "required" : ""%\x3e \x3e\n    \x3c% for (var i\x3d0; i \x3c options.length; i++) { %\x3e\n      \x3c% var option \x3d options[i]; %\x3e\n      \x3coption value\x3d"\x3c%-JSON.stringify(option.value)%\x3e" \x3c%\x3doption.value \x3d\x3d value ? "selected\x3d\'selected\'" : ""%\x3e\x3e\x3c%-option.label%\x3e\x3c/option\x3e\n    \x3c% } %\x3e\n  \x3c/select\x3e\n\x3c/div\x3e'),
events:{"change select":"onChange","focus select":"clearInvalid"},getValueFromDOM:function(){return JSON.parse(this.$el.find("select").val())}});var f=Backform.InputControl=e.extend({defaults:{type:"text",label:"",maxlength:255,extraClasses:[],helpMessage:""},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x3c%-label%\x3e\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cinput type\x3d"\x3c%\x3dtype%\x3e" class\x3d"\x3c%\x3dBackform.controlClassName%\x3e \x3c%\x3dextraClasses.join(\' \')%\x3e" name\x3d"\x3c%\x3dname%\x3e" maxlength\x3d"\x3c%\x3dmaxlength%\x3e" value\x3d"\x3c%-value%\x3e" placeholder\x3d"\x3c%-placeholder%\x3e" \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3c%\x3drequired ? "required" : ""%\x3e /\x3e\n  \x3c% if (helpMessage.length) { %\x3e\n    \x3cspan class\x3d"\x3c%\x3dBackform.helpMessageClassName%\x3e"\x3e\x3c%\x3dhelpMessage%\x3e\x3c/span\x3e\n  \x3c% } %\x3e\n\x3c/div\x3e'),
events:{"change input":"onChange","focus input":"clearInvalid"},getValueFromDOM:function(){return this.$el.find("input").val()}}),g=Backform.BooleanControl=f.extend({defaults:{type:"checkbox",label:"",extraClasses:[]},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x26nbsp;\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cdiv class\x3d"checkbox"\x3e\n    \x3clabel\x3e\n      \x3cinput type\x3d"\x3c%\x3dtype%\x3e" class\x3d"\x3c%\x3dextraClasses.join(\' \')%\x3e" name\x3d"\x3c%\x3dname%\x3e" \x3c%\x3dvalue ? "checked\x3d\'checked\'" : ""%\x3e \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3c%\x3drequired ? "required" : ""%\x3e /\x3e \x3c%-label%\x3e\n    \x3c/label\x3e\n  \x3c/div\x3e\n\x3c/div\x3e'),
getValueFromDOM:function(){return this.$el.find("input").is(":checked")}});Backform.CheckboxControl=g;Backform.RadioControl=f.extend({defaults:{type:"radio",label:"",options:[],extraClasses:[]},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x3c%-label%\x3e\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e \x3c%\x3dBackform.radioControlsClassName%\x3e"\x3e\n  \x3c% for (var i\x3d0; i \x3c options.length; i++) { %\x3e\n    \x3c% var option \x3d options[i]; %\x3e\n    \x3clabel class\x3d"\x3c%\x3dBackform.radioLabelClassName%\x3e"\x3e\n      \x3cinput type\x3d"\x3c%\x3dtype%\x3e" class\x3d"\x3c%\x3dextraClasses.join(\' \')%\x3e" name\x3d"\x3c%\x3dname%\x3e" value\x3d"\x3c%-JSON.stringify(option.value)%\x3e" \x3c%\x3dvalue \x3d\x3d option.value ? "checked\x3d\'checked\'" : ""%\x3e \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3c%\x3drequired ? "required" : ""%\x3e /\x3e \x3c%-option.label%\x3e\n    \x3c/label\x3e\n  \x3c% } %\x3e\n\x3c/div\x3e'),
getValueFromDOM:function(){return JSON.parse(this.$el.find("input:checked").val())},bootstrap2:function(){Backform.radioControlsClassName="controls";Backform.radioLabelClassName="radio inline"}});_.extend(Backform,{radioControlsClassName:"checkbox",radioLabelClassname:"checkbox-inline"});Backform.DatepickerControl=f.extend({defaults:{type:"text",label:"",options:{},extraClasses:[],maxlength:255,helpMessage:""},events:{"changeDate input":"onChange","focus input":"clearInvalid"},render:function(){f.prototype.render.apply(this,
arguments);this.$el.find("input").datepicker(this.field.get("options"));return this}});Backform.ButtonControl=e.extend({defaults:{type:"submit",label:"Submit",status:void 0,message:void 0,extraClasses:[]},template:_.template('\x3clabel class\x3d"\x3c%\x3dBackform.controlLabelClassName%\x3e"\x3e\x26nbsp;\x3c/label\x3e\n\x3cdiv class\x3d"\x3c%\x3dBackform.controlsClassName%\x3e"\x3e\n  \x3cbutton type\x3d"\x3c%\x3dtype%\x3e" name\x3d"\x3c%\x3dname%\x3e" class\x3d"btn \x3c%\x3dextraClasses.join(\' \')%\x3e" \x3c%\x3ddisabled ? "disabled" : ""%\x3e \x3e\x3c%-label%\x3e\x3c/button\x3e\n  \x3c% var cls \x3d ""; if (status \x3d\x3d "error") cls \x3d Backform.buttonStatusErrorClassName; if (status \x3d\x3d "success") cls \x3d Backform.buttonStatusSuccessClassname; %\x3e\n  \x3cspan class\x3d"status \x3c%\x3dcls%\x3e"\x3e\x3c%\x3dmessage%\x3e\x3c/span\x3e\n\x3c/div\x3e'),
initialize:function(){e.prototype.initialize.apply(this,arguments);this.listenTo(this.field,"change:status",this.render);this.listenTo(this.field,"change:message",this.render)},bootstrap2:function(){Backform.buttonStatusErrorClassName="text-error";Backform.buttonStatusSuccessClassname="text-success"}});_.extend(Backform,{buttonStatusErrorClassName:"text-danger",buttonStatusSuccessClassname:"text-success"})}).call(this);
(function(h,f){if("function"===typeof define&&define.amd)define(["backbone","underscore"],function(c,e){return h.Marionette=h.Mn=f(h,c,e)});else if("undefined"!==typeof exports){var e=require("backbone"),p=require("underscore");module.exports=f(h,e,p)}else h.Marionette=h.Mn=f(h,h.Backbone,h._)})(this,function(h,f,e){(function(a,b){var d=a.ChildViewContainer;a.ChildViewContainer=function(a,b){var d=function(a){this._views={};this._indexByModel={};this._indexByCustom={};this._updateLength();b.each(a,
this.add,this)};b.extend(d.prototype,{add:function(a,b){var d=a.cid;this._views[d]=a;a.model&&(this._indexByModel[a.model.cid]=d);b&&(this._indexByCustom[b]=d);this._updateLength();return this},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){return this.findByCid(this._indexByModel[a])},findByCustom:function(a){return this.findByCid(this._indexByCustom[a])},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var d=
a.cid;a.model&&delete this._indexByModel[a.model.cid];b.any(this._indexByCustom,function(a,b){if(a===d)return delete this._indexByCustom[b],!0},this);delete this._views[d];this._updateLength();return this},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,d){b.each(this._views,function(c){b.isFunction(c[a])&&c[a].apply(c,d||[])})},_updateLength:function(){this.length=b.size(this._views)}});b.each("forEach each map find detect filter select reject every all some any include contains invoke toArray first initial rest last without isEmpty pluck".split(" "),
function(a){d.prototype[a]=function(){var d=[b.values(this._views)].concat(b.toArray(arguments));return b[a].apply(b,d)}});return d}(a,b);a.ChildViewContainer.VERSION="0.1.5";a.ChildViewContainer.noConflict=function(){a.ChildViewContainer=d;return this};return a.ChildViewContainer})(f,e);(function(a,b){var d=a.Wreqr,c=a.Wreqr={};a.Wreqr.VERSION="1.3.1";a.Wreqr.noConflict=function(){a.Wreqr=d;return this};c.Handlers=function(a,b){var d=function(a){this.options=a;this._wreqrHandlers={};b.isFunction(this.initialize)&&
this.initialize(a)};d.extend=a.Model.extend;b.extend(d.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,d){var c=null;b.isObject(a)&&!b.isFunction(a)&&(c=a.context,a=a.callback);this.setHandler(d,a,c)},this)},setHandler:function(a,b,d){this._wreqrHandlers[a]={callback:b,context:d};this.trigger("handler:add",a,b,d)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(b)return function(){var a=Array.prototype.slice.apply(arguments);
return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}});return d}(a,b);c.CommandStorage=function(){var d=function(a){this.options=a;this._commands={};b.isFunction(this.initialize)&&this.initialize(a)};b.extend(d.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];b||(b={command:a,instances:[]},this._commands[a]=b);return b},addCommand:function(a,b){this.getCommands(a).instances.push(b)},
clearCommands:function(a){this.getCommands(a).instances=[]}});return d}();c.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var d=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,d)},execute:function(a,b){a=arguments[0];b=Array.prototype.slice.call(arguments,1);this.hasHandler(a)?this.getHandler(a).apply(this,
b):this.storage.addCommand(a,b)},_executeCommands:function(a,d,c){var e=this.storage.getCommands(a);b.each(e.instances,function(a){d.apply(c,a)});this.storage.clearCommands(a)},_initializeStorage:function(a){a=a.storageType||this.storageType;this.storage=b.isFunction(a)?new a:a}})}(c);c.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);if(this.hasHandler(a))return this.getHandler(a).apply(this,b)}})}(c);c.EventAggregator=
function(a,b){var d=function(){};d.extend=a.Model.extend;b.extend(d.prototype,a.Events);return d}(a,b);c.Channel=function(d){d=function(b){this.vent=new a.Wreqr.EventAggregator;this.reqres=new a.Wreqr.RequestResponse;this.commands=new a.Wreqr.Commands;this.channelName=b};b.extend(d.prototype,{reset:function(){this.vent.off();this.vent.stopListening();this.reqres.removeAllHandlers();this.commands.removeAllHandlers();return this},connectEvents:function(a,b){this._connect("vent",a,b);return this},connectCommands:function(a,
b){this._connect("commands",a,b);return this},connectRequests:function(a,b){this._connect("reqres",a,b);return this},_connect:function(a,d,c){if(d){c=c||this;var e="vent"===a?"on":"setHandler";b.each(d,function(d,g){this[a][e](g,b.bind(d,c))},this)}}});return d}(c);c.radio=function(a){var d=function(){this._channels={};this.vent={};this.commands={};this.reqres={};this._proxyMethods()};b.extend(d.prototype,{channel:function(a){if(!a)throw Error("Channel must receive a name");return this._getChannel(a)},
_getChannel:function(b){var d=this._channels[b];d||(d=new a.Channel(b),this._channels[b]=d);return d},_proxyMethods:function(){b.each(["vent","commands","reqres"],function(a){b.each(c[a],function(b){this[a][b]=e(this,a,b)},this)},this)}});var c={vent:"on off trigger once stopListening listenTo listenToOnce".split(" "),commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},e=function(a,b,
d){return function(c){var e=a._getChannel(c)[b],g=Array.prototype.slice.call(arguments,1);return e[d].apply(e,g)}};return new d}(c);return a.Wreqr})(f,e);var p=h.Marionette,c=f.Marionette={};c.VERSION="2.3.2";c.noConflict=function(){h.Marionette=p;return this};f.Marionette=c;c.Deferred=f.$.Deferred;c.extend=f.Model.extend;c.isNodeAttached=function(a){return f.$.contains(document.documentElement,a)};c.getOption=function(a,b){if(a&&b)return a.options&&void 0!==a.options[b]?a.options[b]:a[b]};c.proxyGetOption=
function(a){return c.getOption(this,a)};c._getValue=function(a,b,d){e.isFunction(a)&&(d=d||[],a=a.apply(b,d));return a};c.normalizeMethods=function(a){return e.reduce(a,function(a,d,c){e.isFunction(d)||(d=this[d]);d&&(a[c]=d);return a},{},this)};c.normalizeUIString=function(a,b){return a.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(a){return b[a.slice(4)]})};c.normalizeUIKeys=function(a,b){return e.reduce(a,function(a,e,k){k=c.normalizeUIString(k,b);a[k]=e;return a},{})};c.normalizeUIValues=function(a,
b){e.each(a,function(d,g){e.isString(d)&&(a[g]=c.normalizeUIString(d,b))});return a};c.actAsCollection=function(a,b){e.each("forEach each map find detect filter select reject every all some any include contains invoke toArray first initial rest last without isEmpty pluck".split(" "),function(d){a[d]=function(){var a=[e.values(e.result(this,b))].concat(e.toArray(arguments));return e[d].apply(e,a)}})};var m=c.deprecate=function(a,b){e.isObject(a)&&(a=a.prev+" is going to be removed in the future. Please use "+
a.next+" instead."+(a.url?" See: "+a.url:""));void 0!==b&&b||m._cache[a]||(m._warn("Deprecation warning: "+a),m._cache[a]=!0)};m._warn="undefined"!==typeof console&&(console.warn||console.log)||function(){};m._cache={};c._triggerMethod=function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi;return function(d,c,k){var f=3>arguments.length;f&&(k=c,c=k[0]);var l="on"+c.replace(b,a),l=d[l],n;e.isFunction(l)&&(n=l.apply(d,f?e.rest(k):k));e.isFunction(d.trigger)&&(1<f+k.length?d.trigger.apply(d,
f?k:[c].concat(e.rest(k,0))):d.trigger(c));return n}}();c.triggerMethod=function(a){return c._triggerMethod(this,arguments)};c.triggerMethodOn=function(a){return(e.isFunction(a.triggerMethod)?a.triggerMethod:c.triggerMethod).apply(a,e.rest(arguments))};c.MonitorDOMRefresh=function(a){function b(){a._isShown&&a._isRendered&&c.isNodeAttached(a.el)&&e.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}a.on({show:function(){a._isShown=!0;b()},render:function(){a._isRendered=!0;b()}})};(function(a){function b(b,
d,c,g){g=g.split(/\s+/);e.each(g,function(e){var g=b[e];if(!g)throw new a.Error('Method "'+e+'" was configured as an event handler, but does not exist.');b.listenTo(d,c,g)})}function d(a,b,d,c){a.listenTo(b,d,c)}function c(a,b,d,g){g=g.split(/\s+/);e.each(g,function(c){a.stopListening(b,d,a[c])})}function k(a,b,d,c){a.stopListening(b,d,c)}function f(b,d,c,g,k){if(d&&c){if(!e.isObject(c))throw new a.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});
c=a._getValue(c,b);e.each(c,function(a,c){e.isFunction(a)?g(b,d,c,a):k(b,d,c,a)})}}a.bindEntityEvents=function(a,c,e){f(a,c,e,d,b)};a.unbindEntityEvents=function(a,b,d){f(a,b,d,k,c)};a.proxyBindEntityEvents=function(b,d){return a.bindEntityEvents(this,b,d)};a.proxyUnbindEntityEvents=function(b,d){return a.unbindEntityEvents(this,b,d)}})(c);var q="description fileName lineNumber name message number".split(" ");c.Error=c.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+c.VERSION+"/",constructor:function(a,
b){e.isObject(a)?(b=a,a=b.message):b||(b={});var d=Error.call(this,a);e.extend(this,e.pick(d,q),e.pick(b,q));this.captureStackTrace();b.url&&(this.url=this.urlRoot+b.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,c.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}});c.Error.extend=c.extend;c.Callbacks=function(){this._deferred=c.Deferred();this._callbacks=[]};e.extend(c.Callbacks.prototype,{add:function(a,b){var d=
e.result(this._deferred,"promise");this._callbacks.push({cb:a,ctx:b});d.then(function(d){b&&(d.context=b);a.call(d.context,d.options)})},run:function(a,b){this._deferred.resolve({options:a,context:b})},reset:function(){var a=this._callbacks;this._deferred=c.Deferred();this._callbacks=[];e.each(a,function(a){this.add(a.cb,a.ctx)},this)}});c.Controller=function(a){this.options=a||{};e.isFunction(this.initialize)&&this.initialize(this.options)};c.Controller.extend=c.extend;e.extend(c.Controller.prototype,
f.Events,{destroy:function(){c._triggerMethod(this,"before:destroy",arguments);c._triggerMethod(this,"destroy",arguments);this.stopListening();this.off();return this},triggerMethod:c.triggerMethod,getOption:c.proxyGetOption});c.Object=function(a){this.options=e.extend({},e.result(this,"options"),a);this.initialize.apply(this,arguments)};c.Object.extend=c.extend;e.extend(c.Object.prototype,f.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy");this.triggerMethod("destroy");
this.stopListening()},triggerMethod:c.triggerMethod,getOption:c.proxyGetOption,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});c.Region=c.Object.extend({constructor:function(a){this.options=a||{};this.el=this.getOption("el");this.el=this.el instanceof f.$?this.el[0]:this.el;if(!this.el)throw new c.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el);c.Object.call(this,a)},show:function(a,b){if(this._ensureElement()){this._ensureViewIsIntact(a);
var d=b||{},e=a!==this.currentView,k=!!d.preventDestroy,f=!!d.forceShow,l=!!this.currentView,k=e&&!k,e=e||f;l&&this.triggerMethod("before:swapOut",this.currentView,this,b);this.currentView&&delete this.currentView._parent;k?this.empty():l&&e&&this.currentView.off("destroy",this.empty,this);e&&(a.once("destroy",this.empty,this),a.render(),a._parent=this,l&&this.triggerMethod("before:swap",a,this,b),this.triggerMethod("before:show",a,this,b),c.triggerMethodOn(a,"before:show",a,this,b),l&&this.triggerMethod("swapOut",
this.currentView,this,b),e=c.isNodeAttached(this.el),f=[],f=d.triggerBeforeAttach||this.triggerBeforeAttach,d=d.triggerAttach||this.triggerAttach,e&&f&&(f=this._displayedViews(a),this._triggerAttach(f,"before:")),this.attachHtml(a),this.currentView=a,e&&d&&(f=this._displayedViews(a),this._triggerAttach(f)),l&&this.triggerMethod("swap",a,this,b),this.triggerMethod("show",a,this,b),c.triggerMethodOn(a,"show",a,this,b));return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(a,
b){var d=(b||"")+"attach";e.each(a,function(a){c.triggerMethodOn(a,d,a,this)},this)},_displayedViews:function(a){return e.union([a],e.result(a,"_getNestedViews")||[])},_ensureElement:function(){e.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]);if(!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new c.Error('An "el" '+this.$el.selector+" must exist in DOM");}return!0},_ensureViewIsIntact:function(a){if(!a)throw new c.Error({name:"ViewNotValid",
message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(a.isDestroyed)throw new c.Error({name:"ViewDestroyedError",message:'View (cid: "'+a.cid+'") has already been destroyed and cannot be used.'});},getEl:function(a){return f.$(a,c._getValue(this.options.parentEl,this))},attachHtml:function(a){this.$el.contents().detach();this.el.appendChild(a.el)},empty:function(){var a=this.currentView;if(a)return a.off("destroy",this.empty,this),this.triggerMethod("before:empty",
a),this._destroyView(),this.triggerMethod("empty",a),delete this.currentView,this},_destroyView:function(){var a=this.currentView;a.destroy&&!a.isDestroyed?a.destroy():a.remove&&(a.remove(),a.isDestroyed=!0)},attachView:function(a){this.currentView=a;return this},hasView:function(){return!!this.currentView},reset:function(){this.empty();this.$el&&(this.el=this.$el.selector);delete this.$el;return this}},{buildRegion:function(a,b){if(e.isString(a))return this._buildRegionFromSelector(a,b);if(a.selector||
a.el||a.regionClass)return this._buildRegionFromObject(a,b);if(e.isFunction(a))return this._buildRegionFromRegionClass(a);throw new c.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"});},_buildRegionFromSelector:function(a,b){return new b({el:a})},_buildRegionFromObject:function(a,b){var d=a.regionClass||b,c=e.omit(a,"selector","regionClass");a.selector&&!c.el&&(c.el=a.selector);return new d(c)},_buildRegionFromRegionClass:function(a){return new a}});
c.RegionManager=c.Controller.extend({constructor:function(a){this._regions={};c.Controller.call(this,a);this.addRegions(this.getOption("regions"))},addRegions:function(a,b){a=c._getValue(a,this,arguments);return e.reduce(a,function(a,c,f){e.isString(c)&&(c={selector:c});c.selector&&(c=e.defaults({},c,b));a[f]=this.addRegion(f,c);return a},{},this)},addRegion:function(a,b){var d;d=b instanceof c.Region?b:c.Region.buildRegion(b,c.Region);this.triggerMethod("before:add:region",a,d);d._parent=this;this._store(a,
d);this.triggerMethod("add:region",a,d);return d},get:function(a){return this._regions[a]},getRegions:function(){return e.clone(this._regions)},removeRegion:function(a){var b=this._regions[a];this._remove(a,b);return b},removeRegions:function(){var a=this.getRegions();e.each(this._regions,function(a,d){this._remove(d,a)},this);return a},emptyRegions:function(){var a=this.getRegions();e.invoke(a,"empty");return a},destroy:function(){this.removeRegions();return c.Controller.prototype.destroy.apply(this,
arguments)},_store:function(a,b){this._regions[a]=b;this._setLength()},_remove:function(a,b){this.triggerMethod("before:remove:region",a,b);b.empty();b.stopListening();delete b._parent;delete this._regions[a];this._setLength();this.triggerMethod("remove:region",a,b)},_setLength:function(){this.length=e.size(this._regions)}});c.actAsCollection(c.RegionManager.prototype,"_regions");c.TemplateCache=function(a){this.templateId=a};e.extend(c.TemplateCache,{templateCaches:{},get:function(a){var b=this.templateCaches[a];
b||(b=new c.TemplateCache(a),this.templateCaches[a]=b);return b.load()},clear:function(){var a,b=e.toArray(arguments),d=b.length;if(0<d)for(a=0;a<d;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}});e.extend(c.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var a=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(a)},loadTemplate:function(a){var b=f.$(a).html();if(!b||0===b.length)throw new c.Error({name:"NoTemplateError",
message:'Could not find template: "'+a+'"'});return b},compileTemplate:function(a){return e.template(a)}});c.Renderer={render:function(a,b){if(!a)throw new c.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(e.isFunction(a)?a:c.TemplateCache.get(a))(b)}};c.View=f.View.extend({isDestroyed:!1,constructor:function(a){e.bindAll(this,"render");a=c._getValue(a,this);this.options=e.extend({},e.result(this,"options"),a);this._behaviors=c.Behaviors(this);
f.View.apply(this,arguments);c.MonitorDOMRefresh(this);this.on("show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(a){return a.toJSON.apply(a,e.rest(arguments))},mixinTemplateHelpers:function(a){a=a||{};var b=this.getOption("templateHelpers"),b=c._getValue(b,this);return e.extend(a,b)},normalizeUIKeys:function(a){var b=e.result(this,"_uiBindings");return c.normalizeUIKeys(a,b||e.result(this,"ui"))},normalizeUIValues:function(a){var b=e.result(this,
"ui"),d=e.result(this,"_uiBindings");return c.normalizeUIValues(a,d||b)},configureTriggers:function(){if(this.triggers){var a=this.normalizeUIKeys(e.result(this,"triggers"));return e.reduce(a,function(a,d,c){a[c]=this._buildViewTrigger(d);return a},{},this)}},delegateEvents:function(a){this._delegateDOMEvents(a);this.bindEntityEvents(this.model,this.getOption("modelEvents"));this.bindEntityEvents(this.collection,this.getOption("collectionEvents"));e.each(this._behaviors,function(a){a.bindEntityEvents(this.model,
a.getOption("modelEvents"));a.bindEntityEvents(this.collection,a.getOption("collectionEvents"))},this);return this},_delegateDOMEvents:function(a){var b=c._getValue(a||this.events,this),b=this.normalizeUIKeys(b);e.isUndefined(a)&&(this.events=b);a={};var d=e.result(this,"behaviorEvents")||{},g=this.configureTriggers(),k=e.result(this,"behaviorTriggers")||{};e.extend(a,d,b,g,k);f.View.prototype.delegateEvents.call(this,a)},undelegateEvents:function(){f.View.prototype.undelegateEvents.apply(this,arguments);
this.unbindEntityEvents(this.model,this.getOption("modelEvents"));this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"));e.each(this._behaviors,function(a){a.unbindEntityEvents(this.model,a.getOption("modelEvents"));a.unbindEntityEvents(this.collection,a.getOption("collectionEvents"))},this);return this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new c.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'});
},destroy:function(){if(!this.isDestroyed){var a=e.toArray(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(a));this.isDestroyed=!0;this.triggerMethod.apply(this,["destroy"].concat(a));this.unbindUIElements();this.remove();e.invoke(this._behaviors,"destroy",a);return this}},bindUIElements:function(){this._bindUIElements();e.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=e.result(this,"_uiBindings");
this.ui={};e.each(a,function(a,d){this.ui[d]=this.$(a)},this)}},unbindUIElements:function(){this._unbindUIElements();e.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(e.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(a){var b=e.isObject(a),d=e.defaults({},b?a:{},{preventDefault:!0,stopPropagation:!0}),c=b?d.event:a;return function(a){a&&(a.preventDefault&&d.preventDefault&&
a.preventDefault(),a.stopPropagation&&d.stopPropagation&&a.stopPropagation());this.triggerMethod(c,{view:this,model:this.model,collection:this.collection})}},setElement:function(){var a=f.View.prototype.setElement.apply(this,arguments);e.invoke(this._behaviors,"proxyViewProperties",this);return a},triggerMethod:function(){for(var a=c._triggerMethod,b=a(this,arguments),d=this._behaviors,e=0,f=d&&d.length;e<f;e++)a(d[e],arguments);return b},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var a=
this._getImmediateChildren();return a.length?e.reduce(a,function(a,d){return d._getNestedViews?a.concat(d._getNestedViews()):a},a):a},normalizeMethods:c.normalizeMethods,getOption:c.proxyGetOption,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});c.ItemView=c.View.extend({constructor:function(){c.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var a=[this.model||this.collection];arguments.length&&a.push.apply(a,arguments);
return this.model?this.serializeModel.apply(this,a):{items:this.serializeCollection.apply(this,a)}},serializeCollection:function(a){return a.toJSON.apply(a,e.rest(arguments))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderTemplate();this.bindUIElements();this.triggerMethod("render",this);return this},_renderTemplate:function(){var a=this.getTemplate();if(!1!==a){if(!a)throw new c.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});
var b=this.serializeData(),b=this.mixinTemplateHelpers(b),a=c.Renderer.render(a,b,this);this.attachElContent(a);return this}},attachElContent:function(a){this.$el.html(a);return this}});c.CollectionView=c.View.extend({childViewEventPrefix:"childview",constructor:function(a){var b=a||{};e.isUndefined(this.sort)&&(this.sort=e.isUndefined(b.sort)?!0:b.sort);this.once("render",this._initialEvents);this._initChildViewStorage();c.View.apply(this,arguments);this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=
document.createDocumentFragment();this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer();this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1;this._triggerBeforeShowBufferedChildren();this.attachBuffer(this,this.elBuffer);this._triggerShowBufferedChildren();this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&e.each(this._bufferedChildren,e.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&
(e.each(this._bufferedChildren,e.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(a,b){c.triggerMethodOn(b,a)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(a){this.destroyEmptyView();
var b=this.getChildView(a),d=this.collection.indexOf(a);this.addChild(a,b,d)},_onCollectionRemove:function(a){a=this.children.findByModel(a);this.removeChildView(a);this.checkEmpty()},onShowCalled:function(){this.children.each(e.partial(this._triggerMethodOnChild,"show"))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderChildren();this.triggerMethod("render",this);return this},resortView:function(){this.render()},_sortViews:function(){this.collection.find(function(a,
b){var d=this.children.findByModel(a);return!d||d._index!==b},this)&&this.resortView()},_emptyViewIndex:-1,_renderChildren:function(){this.destroyEmptyView();this.destroyChildren();this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var a;this.collection.each(function(b,d){a=this.getChildView(b);this.addChild(b,
a,d)},this)},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this.triggerMethod("before:render:empty");this._showingEmptyView=!0;var b=new f.Model;this.addEmptyView(b,a);this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(a,
b){var d=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");e.isFunction(d)&&(d=d.call(this,a,this._emptyViewIndex));d=this.buildChildView(a,b,d);d._parent=this;this.proxyChildEvents(d);this._isShown&&c.triggerMethodOn(d,"before:show");this.children.add(d);this.renderChildView(d,this._emptyViewIndex);this._isShown&&c.triggerMethodOn(d,"show")},getChildView:function(a){a=this.getOption("childView");if(!a)throw new c.Error({name:"NoChildViewError",message:'A "childView" must be specified'});
return a},addChild:function(a,b,d){var e=this.getOption("childViewOptions"),e=c._getValue(e,this,[a,d]);a=this.buildChildView(a,b,e);this._updateIndices(a,!0,d);this._addChildView(a,d);a._parent=this;return a},_updateIndices:function(a,b,d){this.sort&&(b&&(a._index=d),this.children.each(function(d){d._index>=a._index&&(d._index+=b?1:-1)}))},_addChildView:function(a,b){this.proxyChildEvents(a);this.triggerMethod("before:add:child",a);this.children.add(a);this.renderChildView(a,b);this._isShown&&!this.isBuffering&&
c.triggerMethodOn(a,"show");this.triggerMethod("add:child",a)},renderChildView:function(a,b){a.render();this.attachHtml(this,a,b);return a},buildChildView:function(a,b,d){a=e.extend({model:a},d);return new b(a)},removeChildView:function(a){a&&(this.triggerMethod("before:remove:child",a),a.destroy?a.destroy():a.remove&&a.remove(),delete a._parent,this.stopListening(a),this.children.remove(a),this.triggerMethod("remove:child",a),this._updateIndices(a,!1));return a},isEmpty:function(){return!this.collection||
0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(a,b){a.$el.append(b)},attachHtml:function(a,b,d){a.isBuffering?(a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b)):a._insertBefore(b,d)||a._insertAfter(b)},_insertBefore:function(a,b){var d;this.sort&&b<this.children.length-1&&(d=this.children.find(function(a){return a._index===b+1}));return d?(d.$el.before(a.el),!0):!1},_insertAfter:function(a){this.$el.append(a.el)},
_initChildViewStorage:function(){this.children=new f.ChildViewContainer},destroy:function(){if(!this.isDestroyed)return this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),c.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var a=this.children.map(e.identity);this.children.each(this.removeChildView,this);this.checkEmpty();return a},proxyChildEvents:function(a){var b=this.getOption("childViewEventPrefix");this.listenTo(a,
"all",function(){var d=e.toArray(arguments),c=d[0],f=this.normalizeMethods(e.result(this,"childEvents"));d[0]=b+":"+c;d.splice(1,0,a);"undefined"!==typeof f&&e.isFunction(f[c])&&f[c].apply(this,d.slice(1));this.triggerMethod.apply(this,d)},this)},_getImmediateChildren:function(){return e.values(this.children._views)}});c.CompositeView=c.CollectionView.extend({constructor:function(){c.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",
this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(a){return this.getOption("childView")||this.constructor},serializeData:function(){var a={};this.model&&(a=e.partial(this.serializeModel,this.model).apply(this,arguments));return a},render:function(){this._ensureViewIsIntact();this.isRendered=!0;this.resetChildViewContainer();
this.triggerMethod("before:render",this);this._renderTemplate();this._renderChildren();this.triggerMethod("render",this);return this},_renderChildren:function(){this.isRendered&&c.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var a={},a=this.serializeData(),a=this.mixinTemplateHelpers(a);this.triggerMethod("before:render:template");var b=this.getTemplate(),a=c.Renderer.render(b,a,this);this.attachElContent(a);this.bindUIElements();this.triggerMethod("render:template")},
attachElContent:function(a){this.$el.html(a);return this},attachBuffer:function(a,b){this.getChildViewContainer(a).append(b)},_insertAfter:function(a){this.getChildViewContainer(this,a).append(a.el)},getChildViewContainer:function(a,b){if("$childViewContainer"in a)return a.$childViewContainer;var d;if(d=c.getOption(a,"childViewContainer")){if(d=c._getValue(d,a),d="@"===d.charAt(0)&&a.ui?a.ui[d.substr(4)]:a.$(d),0>=d.length)throw new c.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+
a.childViewContainer});}else d=a.$el;return a.$childViewContainer=d},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}});c.LayoutView=c.ItemView.extend({regionClass:c.Region,constructor:function(a){a=a||{};this._firstRender=!0;this._initializeRegions(a);c.ItemView.call(this,a)},render:function(){this._ensureViewIsIntact();this._firstRender?this._firstRender=!1:this._reInitializeRegions();return c.ItemView.prototype.render.apply(this,arguments)},destroy:function(){if(this.isDestroyed)return this;
this.regionManager.destroy();return c.ItemView.prototype.destroy.apply(this,arguments)},addRegion:function(a,b){var d={};d[a]=b;return this._buildRegions(d)[a]},addRegions:function(a){this.regions=e.extend({},this.regions,a);return this._buildRegions(a)},removeRegion:function(a){delete this.regions[a];return this.regionManager.removeRegion(a)},getRegion:function(a){return this.regionManager.get(a)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(a){var b={regionClass:this.getOption("regionClass"),
parentEl:e.partial(e.result,this,"el")};return this.regionManager.addRegions(a,b)},_initializeRegions:function(a){var b;this._initRegionManager();b=c._getValue(this.regions,this,[a])||{};var d=this.getOption.call(a,"regions"),d=c._getValue(d,this,[a]);e.extend(b,d);b=this.normalizeUIValues(b);this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new c.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager();
this.regionManager._parent=this;this.listenTo(this.regionManager,"before:add:region",function(a){this.triggerMethod("before:add:region",a)});this.listenTo(this.regionManager,"add:region",function(a,b){this[a]=b;this.triggerMethod("add:region",a,b)});this.listenTo(this.regionManager,"before:remove:region",function(a){this.triggerMethod("before:remove:region",a)});this.listenTo(this.regionManager,"remove:region",function(a,b){delete this[a];this.triggerMethod("remove:region",a,b)})},_getImmediateChildren:function(){return e.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}});
c.Behavior=c.Object.extend({constructor:function(a,b){this.view=b;this.defaults=e.result(this,"defaults")||{};this.options=e.extend({},this.defaults,a);c.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening()},proxyViewProperties:function(a){this.$el=a.$el;this.el=a.el}});c.Behaviors=function(a,b){function d(a,c){if(!b.isObject(a.behaviors))return{};c=d.parseBehaviors(a,c||b.result(a,"behaviors"));d.wrap(a,c,b.keys(f));return c}
function c(a,d){this._view=a;this._viewUI=b.result(a,"ui");this._behaviors=d;this._triggers={}}var e=/^(\S+)\s*(.*)$/,f={behaviorTriggers:function(a,b){return(new c(this,b)).buildBehaviorTriggers()},behaviorEvents:function(d,c){var f={},g=this._uiBindings||b.result(this,"ui");b.each(c,function(d,c){var l={},n=b.clone(b.result(d,"events"))||{},h=d._uiBindings||b.result(d,"ui"),h=b.extend({},g,h),n=a.normalizeUIKeys(n,h),r=0;b.each(n,function(a,f){var g=f.match(e),g=g[1]+"."+[this.cid,c,r++," "].join("")+
g[2],n=b.isFunction(a)?a:d[a];l[g]=b.bind(n,d)},this);f=b.extend(f,l)},this);return f}};b.extend(d,{behaviorsLookup:function(){throw new a.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"});},getBehaviorClass:function(b,c){return b.behaviorClass?b.behaviorClass:a._getValue(d.behaviorsLookup,this,[b,c])[c]},parseBehaviors:function(a,c){return b.chain(c).map(function(c,e){var f=new (d.getBehaviorClass(c,e))(c,a),g=d.parseBehaviors(a,b.result(f,
"behaviors"));return[f].concat(g)}).flatten().value()},wrap:function(a,d,c){b.each(c,function(c){a[c]=b.partial(f[c],a[c],d)})}});b.extend(c.prototype,{buildBehaviorTriggers:function(){b.each(this._behaviors,this._buildTriggerHandlersForBehavior,this);return this._triggers},_buildTriggerHandlersForBehavior:function(d,c){var e=b.extend({},this._viewUI,b.result(d,"ui")),f=b.clone(b.result(d,"triggers"))||{},f=a.normalizeUIKeys(f,e);b.each(f,b.bind(this._setHandlerForBehavior,this,d,c))},_setHandlerForBehavior:function(a,
b,d,c){a=c.replace(/^\S+/,function(a){return a+".behaviortriggers"+b});this._triggers[a]=this._view._buildViewTrigger(d)}});return d}(c,e);c.AppRouter=f.Router.extend({constructor:function(a){this.options=a||{};f.Router.apply(this,arguments);var b=this.getOption("appRoutes"),d=this._getController();this.processAppRoutes(d,b);this.on("route",this._processOnRoute,this)},appRoute:function(a,b){var d=this._getController();this._addAppRoute(d,a,b)},_processOnRoute:function(a,b){if(e.isFunction(this.onRoute)){var d=
e.invert(this.getOption("appRoutes"))[a];this.onRoute(a,d,b)}},processAppRoutes:function(a,b){if(b){var d=e.keys(b).reverse();e.each(d,function(d){this._addAppRoute(a,d,b[d])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(a,b,d){var f=a[d];if(!f)throw new c.Error('Method "'+d+'" was not found on the controller');this.route(b,d,e.bind(f,a))},getOption:c.proxyGetOption,triggerMethod:c.triggerMethod,bindEntityEvents:c.proxyBindEntityEvents,unbindEntityEvents:c.proxyUnbindEntityEvents});
c.Application=c.Object.extend({constructor:function(a){this._initializeRegions(a);this._initCallbacks=new c.Callbacks;this.submodules={};e.extend(this,a);this._initChannel();c.Object.call(this,a)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("before:start",a);this._initCallbacks.run(a,this);this.triggerMethod("start",
a)},addRegions:function(a){return this._regionManager.addRegions(a)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(a){return this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},getRegions:function(){return this._regionManager.getRegions()},module:function(a,b){var d=c.Module.getClass(b),f=e.toArray(arguments);f.unshift(this);return d.create.apply(d,f)},getRegionManager:function(){return new c.RegionManager},_initializeRegions:function(a){var b=
e.isFunction(this.regions)?this.regions(a):this.regions||{};this._initRegionManager();var d=c.getOption(a,"regions");e.isFunction(d)&&(d=d.call(this,a));e.extend(b,d);this.addRegions(b);return this},_initRegionManager:function(){this._regionManager=this.getRegionManager();this._regionManager._parent=this;this.listenTo(this._regionManager,"before:add:region",function(){c._triggerMethod(this,"before:add:region",arguments)});this.listenTo(this._regionManager,"add:region",function(a,b){this[a]=b;c._triggerMethod(this,
"add:region",arguments)});this.listenTo(this._regionManager,"before:remove:region",function(){c._triggerMethod(this,"before:remove:region",arguments)});this.listenTo(this._regionManager,"remove:region",function(a){delete this[a];c._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=e.result(this,"channelName")||"global";this.channel=e.result(this,"channel")||f.Wreqr.radio.channel(this.channelName);this.vent=e.result(this,"vent")||this.channel.vent;this.commands=
e.result(this,"commands")||this.channel.commands;this.reqres=e.result(this,"reqres")||this.channel.reqres}});c.Module=function(a,b,d){this.moduleName=a;this.options=e.extend({},this.options,d);this.initialize=d.initialize||this.initialize;this.submodules={};this._setupInitializersAndFinalizers();this.app=b;e.isFunction(this.initialize)&&this.initialize(a,b,this.options)};c.Module.extend=c.extend;e.extend(c.Module.prototype,f.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(a){this._initializerCallbacks.add(a)},
addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(e.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),e.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),
this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,b){if(a){var d=e.flatten([this,this.app,f,c,f.$,e,b]);a.apply(this,d)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new c.Callbacks;this._finalizerCallbacks=new c.Callbacks},triggerMethod:c.triggerMethod});e.extend(c.Module,{create:function(a,b,d){var c=a,f=e.rest(arguments,3);b=b.split(".");var h=[];h[b.length-1]=d;e.each(b,
function(b,e){var m=c;c=this._getModule(m,b,a,d);this._addModuleDefinition(m,c,h[e],f)},this);return c},_getModule:function(a,b,d,c,f){f=e.extend({},c);c=this.getClass(c);var h=a[b];h||(h=new c(b,d,f),a[b]=h,a.submodules[b]=h);return h},getClass:function(a){var b=c.Module;return a?a.prototype instanceof b?a:a.moduleClass||b:b},_addModuleDefinition:function(a,b,c,e){var f=this._getDefine(c);c=this._getStartWithParent(c,b);f&&b.addDefinition(f,e);this._addStartWithParent(a,b,c)},_getStartWithParent:function(a,
b){var d;return e.isFunction(a)&&a.prototype instanceof c.Module?(d=b.constructor.prototype.startWithParent,e.isUndefined(d)?!0:d):e.isObject(a)?(d=a.startWithParent,e.isUndefined(d)?!0:d):!0},_getDefine:function(a){return!e.isFunction(a)||a.prototype instanceof c.Module?e.isObject(a)?a.define:null:a},_addStartWithParent:function(a,b,c){b.startWithParent=b.startWithParent&&c;b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&
b.start(a)}))}});return c});